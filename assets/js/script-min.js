document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("feedback-form"),a=document.getElementById("feedback-list"),t=document.querySelector(".feedback__pagination"),n=document.getElementById("feedback-details"),s=document.getElementById("feedback-details-content");function d(e){const c=new FormData;c.append("action","load_feedbacks"),c.append("page",e),c.append("security",feedbackFormData.nonce),fetch(feedbackFormData.ajaxurl,{method:"POST",body:c}).then(e=>e.json()).then(e=>{if(e.success){a.innerHTML=e.data.feedbacks;const c=e.data.pagination;let o="";c.has_prev&&(o+=`<button class="feedback__prev" data-page="${c.current_page-1}">Previous</button>`),c.has_next&&(o+=`<button class="feedback__next" data-page="${c.current_page+1}">Next</button>`),t.innerHTML=o,t.querySelectorAll(".feedback__prev, .feedback__next").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const a=parseInt(this.getAttribute("data-page"),10);d(a)})}),a.querySelectorAll(".view-feedback").forEach(e=>{e.addEventListener("click",function(a){const t=e.getAttribute("data-id");!function(e){const a=new FormData;a.append("action","load_feedback_details"),a.append("feedback_id",e),a.append("security",feedbackFormData.nonce),fetch(feedbackFormData.ajaxurl,{method:"POST",body:a}).then(e=>e.json()).then(e=>{console.log("Server response:",e),e.success?(console.log("Received data:",e.data),n.style.display="flex",s.innerHTML=`\n                        <p class="feedback__result">${feedbackFormData.labels.first_name}: <span>${e.data.first_name?e.data.first_name:"No data"}</span></p>\n                        <p class="feedback__result">${feedbackFormData.labels.last_name}: <span>${e.data.last_name?e.data.last_name:"No data"}</span></p>\n                        <p class="feedback__result">${feedbackFormData.labels.email}: <a href="mailto:${e.data.email||""}">${e.data.email?e.data.email:"No data"}</a></p>\n                        <p class="feedback__result">${feedbackFormData.labels.subject}: <span>${e.data.subject?e.data.subject:"No data"}</span></p>\n                        <p class="feedback__result">${feedbackFormData.labels.message}: <span>${e.data.message?e.data.message:"No data"}</span></p>\n                    `):(console.error("Error loading feedback details:",e.data?e.data.message:"Unknown error"),n.style.display="none",s.innerHTML="")}).catch(e=>{console.error("Fetch error:",e),n.style.display="none",s.innerHTML=""})}(t)})})}else console.error("Error loading feedbacks:",e.data.message||"Unknown error"),a.innerHTML="<p>Error loading feedbacks.</p>",t.innerHTML=""}).catch(e=>console.error("Fetch error:",e))}e&&e.addEventListener("submit",function(a){a.preventDefault();const t=new FormData(e);t.append("action","submit_feedback"),t.append("security",feedbackFormData.nonce),fetch(feedbackFormData.ajaxurl,{method:"POST",body:t}).then(e=>e.json()).then(a=>{a.success?(alert(a.data.message),e.reset(),d(1)):alert(a.data.message||"Error submitting feedback")}).catch(e=>console.error("Submit error:",e))}),d(1)});