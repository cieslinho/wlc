document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("feedback-form"),a=document.getElementById("feedback-list"),t=document.querySelector(".feedback__pagination"),n=document.getElementById("feedback-details"),o=document.getElementById("feedback-details-content");function r(e){const d=new FormData;d.append("action","load_feedbacks"),d.append("page",e),d.append("security",feedbackFormData.nonce),fetch(feedbackFormData.ajaxurl,{method:"POST",body:d}).then(e=>e.json()).then(e=>{if(e.success){a.innerHTML=e.data.feedbacks;const d=e.data.pagination;let c="";d.has_prev&&(c+=`<button class="pagination__prev" data-page="${d.current_page-1}">Previous</button>`),d.has_next&&(c+=`<button class="pagination__next" data-page="${d.current_page+1}">Next</button>`),t.innerHTML=c,t.querySelectorAll(".pagination__prev, .pagination__next").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const a=parseInt(this.getAttribute("data-page"),10);r(a)})}),a.querySelectorAll(".view-feedback").forEach(e=>{e.addEventListener("click",function(a){const t=e.getAttribute("data-id");!function(e){const a=new FormData;a.append("action","load_feedback_details"),a.append("feedback_id",e),a.append("security",feedbackFormData.nonce),fetch(feedbackFormData.ajaxurl,{method:"POST",body:a}).then(e=>e.json()).then(e=>{console.log("Server response:",e),e.success?(console.log("Received data:",e.data),n.style.display="block",o.innerHTML=`\n                        <p class="feedback__result">${feedbackFormData.labels.first_name}: ${e.data.first_name?e.data.first_name:"No data"}</p>\n                        <p class="feedback__result">${feedbackFormData.labels.last_name}: ${e.data.last_name?e.data.last_name:"No data"}</p>\n                        <p class="feedback__result">${feedbackFormData.labels.email}: <a href="mailto:${e.data.email||""}">${e.data.email?e.data.email:"No data"}</a></p>\n                        <p class="feedback__result">${feedbackFormData.labels.subject}: ${e.data.subject?e.data.subject:"No data"}</p>\n                        <p class="feedback__result">${feedbackFormData.labels.message}: ${e.data.message?e.data.message:"No data"}</p>\n                    `):(console.error("Error loading feedback details:",e.data?e.data.message:"Unknown error"),n.style.display="none",o.innerHTML="")}).catch(e=>{console.error("Fetch error:",e),n.style.display="none",o.innerHTML=""})}(t)})})}else console.error("Error loading feedbacks:",e.data.message||"Unknown error"),a.innerHTML="<p>Error loading feedbacks.</p>",t.innerHTML=""}).catch(e=>console.error("Fetch error:",e))}e&&e.addEventListener("submit",function(a){a.preventDefault();const t=new FormData(e);t.append("action","submit_feedback"),t.append("security",feedbackFormData.nonce),fetch(feedbackFormData.ajaxurl,{method:"POST",body:t}).then(e=>e.json()).then(a=>{a.success?(alert(a.data.message),e.reset(),r(1)):alert(a.data.message||"Error submitting feedback")}).catch(e=>console.error("Submit error:",e))}),r(1)});